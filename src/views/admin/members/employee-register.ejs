<%- include('../partials/head-admin.ejs') %>

<main class="admin-main">

    <%- include('../partials/header.ejs') %>
    <%- include('../partials/aside.ejs') %>
    <section class="section-adm">
        <div class="content">
            <h1><i class="icon-users"></i><span><i class="icon-plus" style="color: aliceblue;"></i></span> <%=title%>
            </h1>

            <div class="form-member">
                <br>
                <form class="row g-3" method="post" action="/admin/members" id="form-members"
                    enctype="multipart/form-data">

                    <div class="col-md-4">
                        <label for="validationDefault01" class="form-label">Nome</label>
                        <input type="text" class="form-control" name="name" id="validationDefault01" value=""
                            placeholder="Digite o nome de guerra">
                    </div>

                    <div class="col-md-4">
                        <label for="validationDefault02" class="form-label">Nome Completo</label>
                        <input type="text" class="form-control" name="full_name" id="validationDefault02" value=""
                            placeholder="Digite o nome Completo">
                    </div>

                    <div class="col-md-3">
                        <label for="validationDefault04" class="form-label">Função</label>
                        <select class="form-select" name="func" id="func">
                            <option selected disabled value="">Escolha...</option>
                            <option value="TSTSR">TSTSR</option>
                            <option value="TSTPL">TSTPL</option>
                            <option value="TSTJR">TSTJR</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="validationDefault05" class="form-label">Prontuário</label>
                        <input type="text" name="rf" class="form-control" placeholder="Digite o prontuário"
                            id="validationDefault05">
                    </div>
                    <div class="col-md-4">
                        <label for="validationDefaultUsername" class="form-label">Email</label>
                        <div class="input-group">
                            <span class="input-group-text" id="inputGroupPrepend2"><i class="icon-mail"></i></span>
                            <input type="text" class="form-control" name="email" placeholder="Digite o email"
                                id="validationDefaultUsername" aria-describedby="inputGroupPrepend2">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="validationDefaultUsername" class="form-label">Telefone</label>
                        <div class="input-group">
                            <span class="input-group-text" id="inputGroupPrepend2"><i class="icon-phone"></i></span>
                            <input type="text" class="form-control" name="cellphone"
                                placeholder="Digite o número de telefone" id="validationDefaultUsername"
                                aria-describedby="inputGroupPrepend2">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="validationDefault03" class="form-label">Data de aniversário</label>
                        <input type="date" name="birth" class="form-control" id="birth">
                    </div>

                    <div class="col-md-2">
                        <label for="validationDefault04" class="form-label">Sexo</label>
                        <select class="form-select" name="gender" id="gender">
                            <option selected disabled value="">Escolha...</option>
                            <option value="M">M</option>
                            <option value="F">F</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="validationDefault04" class="form-label">Gerência</label>
                        <select class="form-select" name="location" id="location">
                            <option selected disabled value="">Escolha...</option>
                            <option value="RSU">RSU</option>
                            <option value="RLE">RLE</option>
                            <option value="RNO">RNO</option>
                            <option value="ROE">ROE</option>
                            <option value="GTD">GTD</option>
                            <option value="STR">STR</option>

                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="validationDefault03" class="form-label">Foto</label>
                        <input type="file" name="avatar" class="form-control" id="validationDefault03">
                    </div>
                    <div class="col-md-12">
                        <label for="validationDefault03" class="form-label">Frase</label>
                        <input type="text" name="description" class="form-control" id="validationDefault03">
                    </div>
                    <div class="col-12">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="time" id="invalidCheck2">
                            <label class="form-check-label" for="invalidCheck2">
                                Faz parte da equipe DE
                            </label>
                        </div>
                    </div>


                    <div class="btn-content-save col-12">
                        <button type="submit" class="btn  btn-save"><i class="icon-cloud-check"
                                style="color: #fff;"></i> Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </section>
    <%- include('../partials/footer.ejs') %>
</main>

<script>
    const formMembers = document.querySelector("#form-members")
    const name = document.querySelector("input[name='name'")
    const avatar = document.querySelector("input[name='avatar'")
    const email = document.querySelector("input[name='email'")
    const rf = document.querySelector("input[name='rf'")
    const func = document.querySelector('#func')
    const birth = document.querySelector("#birth")
    const full_name = document.querySelector("input[name='full_name'")
    const cellphone = document.querySelector("input[name='cellphone'")
    const description = document.querySelector("input[name='description'")
    const time = document.querySelector("input[name='time'")
    const locatio = document.querySelector("#location")
    const gender = document.querySelector('#gender')

    formMembers.addEventListener("submit", async (e) => {
        e.preventDefault()
        const formData = new FormData();
        formData.append('name', name.value)
        formData.append('func', func.value)
        formData.append('email', email.value)
        formData.append('birth', birth.value)
        formData.append('rf', rf.value)
        formData.append('full_name', full_name.value)
        formData.append('cellphone', cellphone.value)
        formData.append('description', description.value)
        formData.append('time', time.value)
        formData.append('location', locatio.value)
        formData.append('gender', gender.value)

        formData.append('avatar', avatar.files[0])
        const config = {
            headers: {
                Authorization: `Bearer <%=token%>`,
                "Content-Type": `multipart/form-data; boundary=${formData._boundary}`,
            },
        };
        const resposta = await axios.post('<%=url%>/members', formData, config)
        console.log(resposta.data);
        if (resposta) {
            toastr["success"]('Funcionário', 'Cadastrado com Sucesso')
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-top-full-width",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }
            formMembers.reset()
        }

       
       

    })
</script>
<%- include('../partials/scripts.ejs') %>